<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!--common style, js 파일 import-->
    <link href="style/commonStyle.css" rel="stylesheet"/>
    <link href="style/mainPageStyle.css" rel="stylesheet"/>
    <title>8World</title>
</head>
<body>
<script type="module">
    // todo : 이미지 이동 animation 추가
    // todo : 상세 페이지 이동 시 데이터 전달 기능 구현
    // todo : 현재 페이지 js 파일 분리 작업
    // todo : 변수명 함수명 재정리

    // firebase 호출부
    import {initializeApp} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import {getFirestore} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import {collection} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import {getDocs} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDBzg-CgJ_rurOKVL3QsX14yfRyat4fy6c",
        authDomain: "world-6960c.firebaseapp.com",
        projectId: "world-6960c",
        storageBucket: "world-6960c.appspot.com",
        messagingSenderId: "892743835529",
        appId: "1:892743835529:web:b4eef016af8ecfb8884b58"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const data = await getDocs(collection(db, "user"));

    let userArray = []; // Firebase에서 받아온 데이터 Array로 저장
    let arrayCount = 0; // 현재 위치한 row 확인을 위한 변수
    const imageArray = []; // image data

    data.forEach((doc) => {
        // db에 존재하는 데이터 Array로 저장
        const docs = doc.data();

        userArray.push(Object(docs));
    });

    // image tag html에 전달 하는 함수
    const imageArea = () => {
        if (userArray.length) {
            if (userArray.length < 3) {
                for (let i = 0; i < 3; i++) {
                    if (i < userArray.length) {
                        imageArray.push(userArray[i].character_image);
                    } else {
                        imageArray.push("assets/images/pngwing.com.png");
                    }
                }
            } else {
                for (let i = 0; i < userArray.length; i++) {
                    imageArray.push(userArray[i]['character_image']);
                }
            }
        } else {
            for (let i = 0; i < 3; i++) {
                imageArray.push("assets/images/pngwing.com.png");
            }
        }

        // 이미지 노출 html
        document.getElementById("character_image").innerHTML = `
                <div class="image_area ">
                    <div>
                        <img src="${imageArray[arrayCount - 1 < 0 ? imageArray.length - 1 : arrayCount - 1]}" class="character_image" alt="..." onclick="location.href='detailPage.html'"/>
                    </div>

                    <div>
                        <img src="${imageArray[arrayCount]}" class="character_image" alt="..." onclick="location.href='detailPage.html'"/>
                    </div>

                    <div>
                        <img src="${imageArray[arrayCount + 1]}" class="character_image" alt="..." onclick="location.href='detailPage.html'"/>
                    </div>
                </div>
        `;
    }

    //html DOM 생성 완료 후 바로 이미지 노출 되기 위한 코드
    $(document).ready(() => {
        imageArea();
    })

    // 이미지 전환 시 현재 있는 이미지 개수를 넘지 않도록 조정하는 함수
    const changeImage = (moveCount) => {
        if (imageArray.length <= (arrayCount + moveCount)) {
            arrayCount = 0;
        } else if (0 > (arrayCount + moveCount)) {
            arrayCount = imageArray.length - 1;
        } else {
            arrayCount += moveCount;
        }

        imageArea();
    }

    // 이미지 이동 버튼 클릭 이벤트
    $('#left_arrow').on('click', () => {
        changeImage(-1)
    });
    $('#right_arrow').on('click', () => {
        changeImage(1)
    });
</script>

<div class="main">
    <div class="title">8 World</div>
    <div class="description">8조 8은 안으로 굽조 입니다!</div>
    <div class="slider">
        <!-- todo: 화살표 이미지로 변환/ 기능 구현  -->
        <button class="c_button c_button_m" id="left_arrow"><</button>
        <span class="item" id="character_image"></span>
        <button class="c_button_m c_button" id="right_arrow">></button>
    </div>
    <button class="c_button c_button_m" onclick="location.href='addPage.html'">팀원 추가</button>
</div>

</body>
</html>